<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Juego de vocabulario HSK </title>
<style>
  body { font-family: Arial, sans-serif; text-align:center; }
  .hidden { display:none; }
  #grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; max-width:500px; margin:20px auto; }
  .card { padding:20px; background:#f0f0f0; border-radius:10px; cursor:pointer; font-size:20px; user-select:none; }
  #timer,#progress { font-size:20px; margin:10px; }
  #level2 input { padding:8px; font-size:18px; }
  button { padding:8px 15px; margin:5px; font-size:16px; }
  #menu button { min-width:160px; }
  .invisible { visibility:hidden; }

  /* ------- è¿›åº¦æ¡æ ·å¼ ------- */
  #barBox {
    width: 80%;
    height: 20px;
    background: #ddd;
    margin: 10px auto;
    border-radius: 10px;
    overflow: hidden;
  }
  #bar {
    height: 100%;
    width: 0%;
    background: #4caf50;
    transition: width 0.4s;
  }
</style>
</head>
<body>
<h1>HSKè¯è¯­æ¸¸æˆ</h1>
<div id="timer">æ—¶é—´: 0 ç§’</div>
<div id="progress"></div>

<!-- å…³å¡é€‰æ‹© -->
<div id="menu">
  <button onclick="openLevel(1)">Emparejar</button>
  <button onclick="openLevel(2)">Escribir en chino</button>
</div>

<!-- Level 1 æ¶ˆæ¶ˆä¹ -->
<div id="level1" class="hidden">
  <h2>ç¬¬ä¸€å…³ï¼šEmparejar</h2>
  <div>
    <button onclick="startLevel1Run()">Empezar</button>
    <button onclick="prepareLevel1()">Reiniciar</button>
    <button onclick="goHome()">Volver</button>
  </div>
  <p id="summary1"></p>
  <div id="grid"></div>
</div>

<!-- Level 2 è¾“å…¥ä¸­æ–‡ -->
<div id="level2" class="hidden">
  <h2>ç¬¬äºŒå…³ï¼šEscribir en chino</h2>

  <!-- â˜…â˜…â˜…â˜…â˜… è¿›åº¦æ¡åœ¨è¿™é‡Œ â˜…â˜…â˜…â˜…â˜… -->
  <div id="barBox"><div id="bar"></div></div>

  <div>
    <button onclick="startLevel2Run()">Empezar</button>
    <button onclick="goHome()">Volver</button>
  </div>
  <p id="question"></p>
  <input id="answer" placeholder="æŒ‰å›è½¦æäº¤ï¼ˆEnterï¼‰" 
         onkeydown="if(event.key==='Enter') checkAnswer()" 
         disabled autocomplete="off">
  <div>
    <button onclick="showHint()">pista ğŸŒŸ</button>
    <button onclick="showFull()">soluciÃ³n ğŸŒŸğŸŒŸ</button>
  </div>
  <p id="feedback"></p>
  <p id="summary2"></p>
</div>

<script>
const words = [
  {zh:"æ¡Œå­", es:"mesa", py:"zhuÅ zi"},
  {zh:"ä¸Š", es:"encima", py:"shÃ ng"},
  {zh:"ç”µè„‘", es:"ordenador", py:"diÃ n nÇo"},
  {zh:"å’Œ", es:"y", py:"hÃ©"},
  {zh:"æœ¬", es:"cuaderno", py:"bÄ›n"},
  {zh:"é‡Œ", es:"dentro", py:"lÇ"},
  {zh:"å‰é¢", es:"delante", py:"qiÃ¡n miÃ n"},
  {zh:"åé¢", es:"detrÃ¡s", py:"hÃ²u miÃ n"},
  {zh:"æœ‹å‹", es:"amigo", py:"pÃ©ng you"},
  {zh:"è¿™", es:"esto", py:"zhÃ¨"},
  {zh:"æ²¡æœ‰", es:"no tener", py:"mÃ©i yÇ’u"},
  {zh:"èƒ½", es:"poder", py:"nÃ©ng"},
  {zh:"å", es:"sentarse", py:"zuÃ²"},  
];

// -------- å…¨å±€å˜é‡ --------
let time = 0;
let timerInterval = null;
let level1Active = false;
let level2Active = false;

// -------- è®¡æ—¶å™¨ --------
function updateTimerDisplay(){
  document.getElementById('timer').innerText = `æ—¶é—´: ${time} ç§’`;
}
function startTimer(){
  if(timerInterval) return;
  timerInterval = setInterval(()=>{
    time++;
    updateTimerDisplay();
  },1000);
}
function stopTimer(){
  clearInterval(timerInterval);
  timerInterval = null;
}
function resetTimer(){
  stopTimer();
  time = 0;
  updateTimerDisplay();
}

// -------- ä¸»èœå• & å…³å¡åˆ‡æ¢ --------
function openLevel(n){
  document.getElementById('menu').classList.add('hidden');
  document.getElementById('progress').innerText = '';
  if(n===1){
    document.getElementById('level1').classList.remove('hidden');
    document.getElementById('level2').classList.add('hidden');
    prepareLevel1();
  }
  if(n===2){
    document.getElementById('level2').classList.remove('hidden');
    document.getElementById('level1').classList.add('hidden');
    prepareLevel2();
  }
}

function goHome(){
  stopTimer();
  resetTimer();
  level1Active = false;
  level2Active = false;
  document.getElementById('menu').classList.remove('hidden');
  document.getElementById('level1').classList.add('hidden');
  document.getElementById('level2').classList.add('hidden');
  document.getElementById('summary1').innerText='';
  document.getElementById('summary2').innerText='';
  document.getElementById('progress').innerText = 'è¯·é€‰æ‹©ä¸€ä¸ªç»ƒä¹ ';
}

// ---------- Level 1 æ¶ˆæ¶ˆä¹ ----------
let pairs = [];
let selected = [];
let correct1 = 0;
let attempts1 = 0;
const grid = document.getElementById('grid');

function prepareLevel1(){
  pairs = [];
  words.forEach(w=>{
    pairs.push({t:w.zh, match:w.es});
    pairs.push({t:w.es, match:w.zh});
  });
  pairs.sort(()=>Math.random()-0.5);

  grid.innerHTML = '';
  correct1 = 0;
  attempts1 = 0;
  selected = [];
  level1Active = false;
  document.getElementById('summary1').innerText = '';
  resetTimer();

  pairs.forEach(p=>{
    const div = document.createElement('div');
    div.className='card';
    div.innerText = p.t;
    div.dataset.match = p.match;
    div.dataset.active = 'false';
    div.onclick = ()=> selectCard(div);
    grid.appendChild(div);
  });
}

function startLevel1Run(){
  if(level1Active) return;
  level1Active = true;
  Array.from(grid.children).forEach(c=> c.dataset.active='true');
  resetTimer();
  startTimer();
}

function selectCard(div){
  if(!level1Active) return;
  if(selected.length===2 || div.classList.contains('done') || div.dataset.active!=='true') return;

  div.style.background = '#cfc';
  selected.push(div);

  if(selected.length===2){
    attempts1++;
    const d0 = selected[0];
    const d1 = selected[1];
    const match = d0.dataset.match === d1.innerText || d1.dataset.match === d0.innerText;

    if(match){ // å¦‚æœåŒ¹é…å¯¹äº†
      selected.forEach(s=>{
        s.classList.add('done');
        s.style.visibility='hidden';
        s.dataset.active='false';
      });
      correct1++;
      selected = [];

      if(correct1===words.length){
        level1Active = false;
        stopTimer();
        document.getElementById('summary1').innerText =
        `å®Œæˆï¼å…±ç”¨æ—¶ ${time} ç§’ã€‚å°è¯•æ¬¡æ•°ï¼š${attempts1}ã€‚
Finished! Time: ${time} s. Attempts: ${attempts1}.`;
      }
    } else {
  // âŒ é”™è¯¯ï¼šå…ˆå˜çº¢
  selected.forEach(s => s.style.background = '#f99'); // çº¢è‰²

  // â³ å†æ¢å¤åŸæ¥çš„ç°è‰²
  setTimeout(() => {
    selected.forEach(s => s.style.background = '#f0f0f0');
    selected = [];
  }, 500);
}

  }
}

// ---------- Level 2 è¾“å…¥ä¸­æ–‡ ----------
let index = 0;
let order = [];
let correct2 = 0;
let attempts2 = 0;

function prepareLevel2(){
  order = [...words];
  order.sort(()=>Math.random()-0.5);
  index = 0;
  correct2 = 0;
  attempts2 = 0;
  level2Active = false;

  document.getElementById('answer').disabled = true;
  document.getElementById('answer').value = '';
  document.getElementById('feedback').innerText = '';
  document.getElementById('summary2').innerText = '';

  updateBar();   // â˜… é‡ç½®è¿›åº¦æ¡

  loadQ();
}

function startLevel2Run(){
  if(level2Active) return;
  level2Active = true;
  document.getElementById('answer').disabled = false;
  document.getElementById('answer').focus();
  resetTimer();
  startTimer();
}

// ------ æ›´æ–°è¿›åº¦æ¡ ------
function updateBar(){
  const percent = (index / words.length) * 100;
  document.getElementById('bar').style.width = percent + "%";
}

function loadQ(){
  document.getElementById('question').innerHTML = `
    <span>Por favor escribe el chino:<br>
      <span style="font-size:28px;">${order[index].es}</span>
    </span>
  `;
  document.getElementById('answer').value='';
  document.getElementById('feedback').innerText='';
}

function checkAnswer(){
  if(!level2Active) return;
  const a = document.getElementById('answer').value.trim();
  attempts2++;

  if(a === order[index].zh){
    document.getElementById('feedback').innerText = `å¥½å‰å®³ï¼ Muy bien!`;
    correct2++;
    index++;

    updateBar();   // â˜… æ¯ç­”å¯¹1é¢˜ï¼Œæ›´æ–°è¿›åº¦æ¡

    if(index === order.length){
      level2Active = false;
      stopTimer();
      updateBar();
      document.getElementById('summary2').innerText =
        `å®Œæˆï¼å…±ç­”å¯¹ ${correct2}/${order.length} é¢˜ï¼Œç”¨æ—¶ ${time} ç§’ï¼Œå°è¯• ${attempts2} æ¬¡ã€‚
Â¡Completado! Aciertos: ${correct2}/${order.length}, Tiempo: ${time} s, Intentos: ${attempts2}.`;
    } else {
      setTimeout(loadQ,600);
    }
  } else {
    document.getElementById('feedback').innerText = `ä¸æ­£ç¡®ï¼Œè¯·å†è¯•ä¸€æ¬¡ã€‚ / Incorrecto, intÃ©ntalo de nuevo.`;
  }
}

function showHint(){
  if(!level2Active) return;
  const zh = order[index].zh;
  const py = order[index].py.split(" ").map(p => p[0] + "...").join(" ");
  document.getElementById('feedback').innerHTML = `${zh}<br>${py}`;
}

function showFull(){
  if(!level2Active) return;
  document.getElementById('feedback').innerText = `${order[index].zh} (${order[index].py})`;
}

// ---------- åˆå§‹åŒ– Level 1 ----------
prepareLevel1();
</script>
</body>
</html>
